#!/bin/sh

dbus-update-activation-environment --systemd \
	SWAYSOCK WAYLAND_DISPLAY DISPLAY

# SSH_AUTH_SOCK has been explicitly set in sway-session
if [ "$SSH_AUTH_SOCK" != "$(gpgconf -L agent-ssh-socket)" ]; then
	ssh-agent -a "$SSH_AUTH_SOCK"
fi

# pinentry-gtk only recognizes DISPLAY
DISPLAY="$WAYLAND_DISPLAY" gpg-connect-agent UPDATESTARTUPTTY /bye

nm-applet &
fcitx5 &

swayidle -w \
    timeout 300 'swaylock -f -c 000000' \
    timeout 330 'swaymsg "output * dpms off"' resume 'swaymsg "output * dpms on"' \
    before-sleep 'swaylock -f -c 000000' \
    after-resume 'swaymsg "output * enable"' &
