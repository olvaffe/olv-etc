#!/bin/sh

cli_min="
	base
	bc
	htop
	lsof
	openssh
	strace
	sudo
	vim
"

cli_base="
	ctags
	git
	man-db
	man-pages
	python
	rsync
	unzip
	usbutils
	zip
"

cli_std="
	dmidecode
	iw
	ldns
	picocom
	trace-cmd
	wireguard-tools
"

cli_extra="
	android-tools
	mesa-utils
	nordvpn-bin
	perf
	vulkan-tools
"

gui_min="
	alacritty
	i3status
	noto-fonts
	polkit
	sway
"

gui_base="
	brightnessctl
	grim
	mako
	pipewire-pulse
	slurp
	swayidle
	swayimg
	swaylock
	wayland-utils
	wl-clipboard
"

gui_std="
	fcitx5-chewing
	fcitx5-configtool
	fcitx5-gtk
	google-chrome
	gtk4
	noto-fonts-cjk
	noto-fonts-emoji
"

gui_extra="
	cups
	mpv
	xdg-desktop-portal-gtk
	xdg-desktop-portal-wlr
"

dev_min="
	base-devel
	ccache
	gdb
	meson
"

dev_base="
	clang
	cmake
"

dev_mesa="
	glslang
	libclc
	llvm
	spirv-llvm-translator
"

dev_cross="
	aarch64-linux-gnu-gcc
	qemu-user-static-binfmt
"

hw_metal="
	btrfs-progs
	dosfstools
	linux-firmware-realtek
	wireless-regdb
	zram-generator
"

hw_x86="
	linux
	sbctl
	systemd-ukify
"

hw_arm="
	archlinuxarm-keyring
"

hw_t580="
	linux-firmware-intel
	intel-ucode
	iwd
	vulkan-intel
"

hw_xps="
	bcm20702a1-firmware
	broadcom-wl-dkms
	intel-ucode
	linux-headers
	vulkan-intel
	wpa_supplicant
"

hw_opi="
	seatd
	vulkan-tools
"

hw_crostini="
	cros-container-guest-tools-git
"

pkgs=""

host="$(uname -n)"
case "$host" in
	"t580")
		pkgs="$pkgs $cli_min $cli_base $cli_std $cli_extra"
		pkgs="$pkgs $gui_min $gui_base $gui_std $gui_extra"
		pkgs="$pkgs $dev_min $dev_base $dev_mesa $dev_cross"
		pkgs="$pkgs $hw_metal $hw_x86 $hw_t580"
		;;
	"xps")
		pkgs="$pkgs $cli_min $cli_base $cli_std $cli_extra"
		pkgs="$pkgs $gui_min $gui_base $gui_std $gui_extra"
		pkgs="$pkgs $dev_min $dev_base $dev_mesa $dev_cross"
		pkgs="$pkgs $hw_metal $hw_x86 $hw_xps"
		;;
	"opi")
		pkgs="$pkgs $cli_min $cli_base"
		pkgs="$pkgs $gui_min"
		pkgs="$pkgs $dev_min $dev_base $dev_mesa"
		pkgs="$pkgs $hw_metal $hw_arm $hw_opi"
		;;
	"crostini")
		pkgs="$pkgs $cli_min $cli_base"
		pkgs="$pkgs $hw_crostini"
		;;
	*)
		echo "unknown device: $host"
		exit 1
		;;
esac

qeq="$(pacman -Qeq)"
if [ -n "$qeq" ]; then
	pacman -Dq --asdeps $qeq
fi

#pacman -S --needed $pkgs
pacman -Dq --asexplicit $pkgs
