#!/bin/sh

SRC="$(dirname "$(realpath "$0")")"
DST="$HOME"

create_xdg_base_dirs() {
	for dir in .cache .config .local; do
		mkdir -p -m 0700 "$DST/$dir"
	done

	for dir in bin share state; do
		mkdir -p -m 0700 "$DST/.local/$dir"
	done
}

install() {
	orig="$1"
	src="$SRC/$1"
	dst="$DST/$2"

	if [ -e "$dst" ]; then
		[ "$(realpath "$dst")" = "$src" ] || echo "$dst already exists"
		return
	fi

	dst_dir="$(dirname "$dst")"
	if mkdir -p -m 0700 "$dst_dir" && ln -s "$src" "$dst"; then
		echo "$orig installed"
	fi
}

create_xdg_base_dirs

install "bashrc" ".bashrc"
install "bash_paths" ".bash_paths"
install "bash_aliases" ".bash_aliases"
install "bash_profile" ".bash_profile"

install "sway-session" ".local/bin/sway-session"
install "sway-session-autostart" ".local/bin/sway-session-autostart"
install "sway-config" ".config/sway/config"
install "i3status-config" ".config/i3status/config"
install "alacritty.yml" ".config/alacritty/alacritty.yml"
install "fontconfig-fonts.conf" ".config/fontconfig/fonts.conf"

install "vimrc" ".vim/vimrc"
install "vim-pack" ".vim/pack"
install "gitconfig" ".config/git/config"
touch "$DST/.config/git/credentials"

install "ssh-config" ".ssh/config"
install "tmux.conf" ".tmux.conf"

for script in "$SRC/scripts/"*; do
	if [ -x "$script" ]; then
		name="${script#$SRC/scripts/}"
		install "scripts/$name" ".local/bin/$name"
	fi
done
